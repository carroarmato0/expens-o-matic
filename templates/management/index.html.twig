{% extends 'base.html.twig' %}

{% block title %}expens-o-matic Management{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
  <script>
    var ctx = document.getElementById('statsChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: [
                'January',
                'February',
                'March',
                'April',
                'May',
                'June',
                'July',
                'August',
                'September',
                'October',
                'November',
                'December'
            ],
            datasets: [{
                label: 'Expenses',
                {% if expenses_stats is not empty %}
                  data: [
                  {% for month in 1..12 %}
                      {% if expenses_stats[month] is defined %}
                      {{ expenses_stats[month] }},
                      {% else %}
                      0,
                      {% endif %}
                  {% endfor %}
                ],
                backgroundColor: [
                  {% for month in 1..12 %}
                    'rgba(54, 162, 235, 0.2)',
                  {% endfor %}
                ],
                borderColor: [
                  {% for month in 1..12 %}
                    'rgba(54, 162, 235, 1)',
                  {% endfor %}
                ],
                {% endif %}
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                yAxis: [{
                   ticks: {
                       min: 0,
                       beginAtZero: true,
                   },
                   scaleLabel: {
                       display: true,
                       labelString: "Amount",
                   }
                }],
            },
            legend: {
                display: false,
            },
        }
    });
  </script>
{% endblock %}

{% block body %}

<div class="container-fluid col-xl-8 p-4">

  <div id="stats" class="row">
    <canvas id="statsChart" width="400" height="100"></canvas>
  </div>

  <div id="expenses_pending" class="row">
    <h3 class="mb-3">Pending Expenses</h3>
    {% if pending_expenses is empty %}
    <div class="container-fluid alert alert-secondary">
      <p class="mb-0">There are no pending expenses</p>
    </div>
    {% else %}
    <div class="list-group container-fluid">
      {% for expense in pending_expenses %}
        <a href="/expense/{{ expense.id }}" class="list-group-item list-group-item-action flex-column align-items-start">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ expense.name }}</h5>
            <small>â‚¬ {{ expense.amount | number_format(2) }}</small>
          </div>
          <p>{{ expense.userId.surname }} {{ expense.userId.name }}</p>
          <p class="mb-1">{{ expense.date | date("Y-m-d") }}</p>
          {% if expense.reimbursed == 1 %}
            <span class="badge badge-success">Paid</span>
          {% else %}
            {% if expense.approved is empty %}
              <span class="badge badge-info">Pending</span>
            {% elseif expense.approved == 1 %}
              <span class="badge badge-success">Approved</span>
            {% else %}
              <span class="badge badge-danger">Rejected</span>
            {% endif %}
          {% endif %}
        </a>
      {% endfor %}
    </div>

    {% endif %}
  </div>

</div>

{% endblock %}